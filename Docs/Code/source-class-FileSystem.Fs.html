<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="generator" content="ApiGen 2.8.0" />
	<meta name="robots" content="noindex" />

	<title>File classes/FileSystem/Fs.php</title>

	<script type="text/javascript" src="resources/combined.js?522072721"></script>
	<script type="text/javascript" src="elementlist.js?259314753"></script>
	<link rel="stylesheet" type="text/css" media="all" href="resources/bootstrap.min.css?260161822" />
	<link rel="stylesheet" type="text/css" media="all" href="resources/style.css?2015443609" />

</head>

<body>
	<div id="navigation" class="navbar navbar-fixed-top">
		<div class="navbar-inner">
			<div class="container">
				<a href="index.html" class="brand">Overview</a>
				<div class="nav-collapse">
					<ul class="nav">
						<li>
							<a href="namespace-FileSystem.html" title="Summary of FileSystem"><span>Namespace</span></a>
						</li>
						<li>
							<a href="class-FileSystem.Fs.html" title="Summary of FileSystem\Fs"><span>Class</span></a>
						</li>

						<li class="divider-vertical"></li>

						<li>
							<a href="tree.html" title="Tree view of classes, interfaces, traits and exceptions"><span>Tree</span></a>
						</li>


					</ul>
				</div>
			</div>
		</div>
	</div>

	<div id="left">
	<div id="menu">
		<form id="search" class="form-search">
			<input type="hidden" name="cx" value="" />
			<input type="hidden" name="ie" value="UTF-8" />
			<input type="text" name="q" class="search-query" placeholder="Search" />
		</form>


		<div id="groups">
			<h3>Namespaces</h3>
			<ul>
				<li><a href="namespace-Admin.html">Admin</a>
						</li>
				<li><a href="namespace-Components.html">Components</a>
						</li>
				<li><a href="namespace-Db.html">Db</a>
						</li>
				<li class="active"><a href="namespace-FileSystem.html">FileSystem</a>
						</li>
				<li><a href="namespace-Forms.html">Forms<span></span></a>
						<ul>
				<li><a href="namespace-Forms.Fields.html">Fields</a>
						</li>
							</ul></li>
				<li><a href="namespace-Ldap.html">Ldap</a>
						</li>
				<li><a href="namespace-Logs.html">Logs</a>
						</li>
				<li><a href="namespace-Michelf.html">Michelf</a>
						</li>
				<li><a href="namespace-Modules.html">Modules</a>
						</li>
				<li><a href="namespace-None.html">None</a>
						</li>
				<li><a href="namespace-PHP.html">PHP</a>
						</li>
				<li><a href="namespace-Profiles.html">Profiles</a>
						</li>
				<li><a href="namespace-Settings.html">Settings</a>
						</li>
				<li><a href="namespace-Users.html">Users</a>
						</li>
			</ul>
		</div>


		<div id="elements">
			<h3>Classes</h3>
			<ul>
				<li class="active"><a href="class-FileSystem.Fs.html">Fs</a></li>
				<li><a href="class-FileSystem.Upload.html">Upload</a></li>
			</ul>





		</div>
	</div>
</div>

<div id="splitter"></div>

<div id="right">
	<div id="rightInner">
<pre id="source"><code><span id="1" class="l"><a class="l" href="#1">  1 </a><span class="xlang">&lt;?php</span>
</span><span id="2" class="l"><a class="l" href="#2">  2 </a><span class="php-comment">/**
</span></span><span id="3" class="l"><a class="l" href="#3">  3 </a><span class="php-comment"> * Created by PhpStorm.
</span></span><span id="4" class="l"><a class="l" href="#4">  4 </a><span class="php-comment"> * User: cedric.gallard
</span></span><span id="5" class="l"><a class="l" href="#5">  5 </a><span class="php-comment"> * Date: 23/04/14
</span></span><span id="6" class="l"><a class="l" href="#6">  6 </a><span class="php-comment"> * Time: 09:29
</span></span><span id="7" class="l"><a class="l" href="#7">  7 </a><span class="php-comment"> */</span>
</span><span id="8" class="l"><a class="l" href="#8">  8 </a>
</span><span id="9" class="l"><a class="l" href="#9">  9 </a><span class="php-keyword1">namespace</span> FileSystem;
</span><span id="10" class="l"><a class="l" href="#10"> 10 </a>
</span><span id="11" class="l"><a class="l" href="#11"> 11 </a>
</span><span id="12" class="l"><a class="l" href="#12"> 12 </a><span class="php-keyword1">use</span> Logs\Alert;
</span><span id="13" class="l"><a class="l" href="#13"> 13 </a><span class="php-keyword1">use</span> stdClass;
</span><span id="14" class="l"><a class="l" href="#14"> 14 </a>
</span><span id="15" class="l"><a class="l" href="#15"> 15 </a><span class="php-comment">/**
</span></span><span id="16" class="l"><a class="l" href="#16"> 16 </a><span class="php-comment"> * Classe de gestion des points de montage de partages réseaux
</span></span><span id="17" class="l"><a class="l" href="#17"> 17 </a><span class="php-comment"> *
</span></span><span id="18" class="l"><a class="l" href="#18"> 18 </a><span class="php-comment"> * @package FileSystem
</span></span><span id="19" class="l"><a class="l" href="#19"> 19 </a><span class="php-comment"> */</span>
</span><span id="20" class="l"><a class="l" href="#20"> 20 </a><span class="php-keyword1">class</span> <a id="Fs" href="#Fs">Fs</a> {
</span><span id="21" class="l"><a class="l" href="#21"> 21 </a>
</span><span id="22" class="l"><a class="l" href="#22"> 22 </a>    <span class="php-comment">/**
</span></span><span id="23" class="l"><a class="l" href="#23"> 23 </a><span class="php-comment">     * Serveur sur lequel faire le montage. Utiliser 'localhost' pour le serveur local.
</span></span><span id="24" class="l"><a class="l" href="#24"> 24 </a><span class="php-comment">     * @var string
</span></span><span id="25" class="l"><a class="l" href="#25"> 25 </a><span class="php-comment">     */</span>
</span><span id="26" class="l"><a class="l" href="#26"> 26 </a>    <span class="php-keyword1">protected</span> <span class="php-var"><a id="$server" href="#$server">$server</a></span> = <span class="php-keyword1">null</span>;
</span><span id="27" class="l"><a class="l" href="#27"> 27 </a>
</span><span id="28" class="l"><a class="l" href="#28"> 28 </a>    <span class="php-comment">/**
</span></span><span id="29" class="l"><a class="l" href="#29"> 29 </a><span class="php-comment">     * Chemin du point de montage
</span></span><span id="30" class="l"><a class="l" href="#30"> 30 </a><span class="php-comment">     * @var string
</span></span><span id="31" class="l"><a class="l" href="#31"> 31 </a><span class="php-comment">     */</span>
</span><span id="32" class="l"><a class="l" href="#32"> 32 </a>    <span class="php-keyword1">protected</span> <span class="php-var"><a id="$path" href="#$path">$path</a></span> = <span class="php-keyword1">null</span>;
</span><span id="33" class="l"><a class="l" href="#33"> 33 </a>
</span><span id="34" class="l"><a class="l" href="#34"> 34 </a>    <span class="php-comment">/**
</span></span><span id="35" class="l"><a class="l" href="#35"> 35 </a><span class="php-comment">     * Préfixe facultatif pour le points de montage
</span></span><span id="36" class="l"><a class="l" href="#36"> 36 </a><span class="php-comment">     * @var string
</span></span><span id="37" class="l"><a class="l" href="#37"> 37 </a><span class="php-comment">     */</span>
</span><span id="38" class="l"><a class="l" href="#38"> 38 </a>    <span class="php-keyword1">protected</span> <span class="php-var"><a id="$prefix" href="#$prefix">$prefix</a></span> = <span class="php-keyword1">null</span>;
</span><span id="39" class="l"><a class="l" href="#39"> 39 </a>
</span><span id="40" class="l"><a class="l" href="#40"> 40 </a>    <span class="php-comment">/**
</span></span><span id="41" class="l"><a class="l" href="#41"> 41 </a><span class="php-comment">     * Nom utilisé pour créer le point de montage
</span></span><span id="42" class="l"><a class="l" href="#42"> 42 </a><span class="php-comment">     * @var string
</span></span><span id="43" class="l"><a class="l" href="#43"> 43 </a><span class="php-comment">     */</span>
</span><span id="44" class="l"><a class="l" href="#44"> 44 </a>    <span class="php-keyword1">protected</span> <span class="php-var"><a id="$mountName" href="#$mountName">$mountName</a></span> = <span class="php-keyword1">null</span>;
</span><span id="45" class="l"><a class="l" href="#45"> 45 </a>
</span><span id="46" class="l"><a class="l" href="#46"> 46 </a>    <span class="php-comment">/**
</span></span><span id="47" class="l"><a class="l" href="#47"> 47 </a><span class="php-comment">     * Point de montage activé ou non
</span></span><span id="48" class="l"><a class="l" href="#48"> 48 </a><span class="php-comment">     * @var bool
</span></span><span id="49" class="l"><a class="l" href="#49"> 49 </a><span class="php-comment">     */</span>
</span><span id="50" class="l"><a class="l" href="#50"> 50 </a>    <span class="php-keyword1">protected</span> <span class="php-var"><a id="$isMounted" href="#$isMounted">$isMounted</a></span> = <span class="php-keyword1">false</span>;
</span><span id="51" class="l"><a class="l" href="#51"> 51 </a>
</span><span id="52" class="l"><a class="l" href="#52"> 52 </a>    <span class="php-comment">/**
</span></span><span id="53" class="l"><a class="l" href="#53"> 53 </a><span class="php-comment">     * Classe de gestion des points de montage de partages réseaux
</span></span><span id="54" class="l"><a class="l" href="#54"> 54 </a><span class="php-comment">     *
</span></span><span id="55" class="l"><a class="l" href="#55"> 55 </a><span class="php-comment">     * @param string $path Chemin du point de montage.
</span></span><span id="56" class="l"><a class="l" href="#56"> 56 </a><span class="php-comment">     *  - Pour un partage SMB, on indique le chemin local ou un partage réseau sur le serveur. Ex : pour accéder au répertoire 'Scripts' sur le disque D d'un serveur, on indique 'd:\Scripts' et la fonction passera par le partage administratif 'd$\scripts'
</span></span><span id="57" class="l"><a class="l" href="#57"> 57 </a><span class="php-comment">     *  - on peut aussi indiquer un partage SMB complet
</span></span><span id="58" class="l"><a class="l" href="#58"> 58 </a><span class="php-comment">     * @param string $server Serveur sur lequel est stocké le chemin. Ce serveur doit être soit 'localhost' pour le serveur local, soit un serveur accessible par smb (partage Windows). Ce peut être un nom ou une adresse IP. Le serveur peut-être directement renseigné dans $path (facultatif)
</span></span><span id="59" class="l"><a class="l" href="#59"> 59 </a><span class="php-comment">     * @param string $prefix Préfixe du point de montage dans /mnt. (facultatif)
</span></span><span id="60" class="l"><a class="l" href="#60"> 60 </a><span class="php-comment">     */</span>
</span><span id="61" class="l"><a class="l" href="#61"> 61 </a>    <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> <a id="___construct" href="#___construct">__construct</a>(<span class="php-var">$path</span>, <span class="php-var">$server</span> = <span class="php-keyword1">null</span>, <span class="php-var">$prefix</span> = <span class="php-keyword1">null</span>){
</span><span id="62" class="l"><a class="l" href="#62"> 62 </a>        <span class="php-keyword1">if</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$server</span>)) {
</span><span id="63" class="l"><a class="l" href="#63"> 63 </a>            <span class="php-var">$this</span>-&gt;server = <span class="php-var">$server</span>;
</span><span id="64" class="l"><a class="l" href="#64"> 64 </a>            <span class="php-var">$this</span>-&gt;path = <span class="php-var">$path</span>;
</span><span id="65" class="l"><a class="l" href="#65"> 65 </a>        }<span class="php-keyword1">else</span>{
</span><span id="66" class="l"><a class="l" href="#66"> 66 </a>            <span class="php-comment">// Possibilité d'optimisation : Il y a probablement plus efficace pour récupérer le nom du serveur et le chemin du partage...</span>
</span><span id="67" class="l"><a class="l" href="#67"> 67 </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">mb_substr</span>(<span class="php-var">$path</span>, <span class="php-num">0</span>, <span class="php-num">2</span>) == <span class="php-quote">'\\\\'</span>){
</span><span id="68" class="l"><a class="l" href="#68"> 68 </a>                <span class="php-var">$tmpPath</span> = <span class="php-keyword2">mb_substr</span>(<span class="php-var">$path</span>, <span class="php-num">2</span>);
</span><span id="69" class="l"><a class="l" href="#69"> 69 </a>                <span class="php-comment">//$tmpPath = str_replace('\\\\', '', $path);</span>
</span><span id="70" class="l"><a class="l" href="#70"> 70 </a>                <span class="php-var">$tab</span> = <span class="php-keyword2">explode</span>(<span class="php-quote">'\\'</span>, <span class="php-var">$tmpPath</span>);
</span><span id="71" class="l"><a class="l" href="#71"> 71 </a>                <span class="php-var">$this</span>-&gt;server = <span class="php-var">$tab</span>[<span class="php-num">0</span>];
</span><span id="72" class="l"><a class="l" href="#72"> 72 </a>                <span class="php-keyword1">unset</span>(<span class="php-var">$tab</span>[<span class="php-num">0</span>]);
</span><span id="73" class="l"><a class="l" href="#73"> 73 </a>                <span class="php-var">$this</span>-&gt;path = <span class="php-keyword2">implode</span>(<span class="php-quote">'\\'</span>, <span class="php-var">$tab</span>);
</span><span id="74" class="l"><a class="l" href="#74"> 74 </a>            }<span class="php-keyword1">else</span>{
</span><span id="75" class="l"><a class="l" href="#75"> 75 </a>                <span class="php-var">$this</span>-&gt;server = <span class="php-quote">'localhost'</span>;
</span><span id="76" class="l"><a class="l" href="#76"> 76 </a>                <span class="php-var">$this</span>-&gt;path = <span class="php-var">$path</span>;
</span><span id="77" class="l"><a class="l" href="#77"> 77 </a>            }
</span><span id="78" class="l"><a class="l" href="#78"> 78 </a>        }
</span><span id="79" class="l"><a class="l" href="#79"> 79 </a>        <span class="php-keyword1">if</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$prefix</span>)) <span class="php-var">$this</span>-&gt;prefix = <span class="php-var">$prefix</span>;
</span><span id="80" class="l"><a class="l" href="#80"> 80 </a>        <span class="php-var">$path</span> = <span class="php-keyword2">str_replace</span>(<span class="php-quote">':'</span>, <span class="php-quote">'_'</span>, <span class="php-var">$this</span>-&gt;path);
</span><span id="81" class="l"><a class="l" href="#81"> 81 </a>        <span class="php-var">$path</span> = <span class="php-keyword2">str_replace</span>(<span class="php-quote">'\\'</span>, <span class="php-quote">'_'</span>, <span class="php-var">$path</span>);
</span><span id="82" class="l"><a class="l" href="#82"> 82 </a>        <span class="php-var">$path</span> = <span class="php-keyword2">str_replace</span>(<span class="php-quote">'$'</span>, <span class="php-quote">'_'</span>, <span class="php-var">$path</span>);
</span><span id="83" class="l"><a class="l" href="#83"> 83 </a>        <span class="php-var">$path</span> = <span class="php-keyword2">str_replace</span>(<span class="php-quote">' '</span>, <span class="php-quote">'_'</span>, <span class="php-var">$path</span>);
</span><span id="84" class="l"><a class="l" href="#84"> 84 </a>        <span class="php-var">$this</span>-&gt;mountName = (<span class="php-var">$this</span>-&gt;server == <span class="php-quote">'localhost'</span>) ? <span class="php-var">$this</span>-&gt;path : <span class="php-quote">'/mnt/'</span>.<span class="php-var">$this</span>-&gt;prefix.<span class="php-quote">'_'</span>.<span class="php-var">$this</span>-&gt;server.<span class="php-quote">'_'</span>.<span class="php-var">$path</span>;
</span><span id="85" class="l"><a class="l" href="#85"> 85 </a>        <span class="php-var">$this</span>-&gt;mount();
</span><span id="86" class="l"><a class="l" href="#86"> 86 </a>    }
</span><span id="87" class="l"><a class="l" href="#87"> 87 </a>
</span><span id="88" class="l"><a class="l" href="#88"> 88 </a>    <span class="php-comment">/**
</span></span><span id="89" class="l"><a class="l" href="#89"> 89 </a><span class="php-comment">     * Retourne le statut du montage
</span></span><span id="90" class="l"><a class="l" href="#90"> 90 </a><span class="php-comment">     * @return boolean
</span></span><span id="91" class="l"><a class="l" href="#91"> 91 </a><span class="php-comment">     */</span>
</span><span id="92" class="l"><a class="l" href="#92"> 92 </a>    <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> <a id="_getIsMounted" href="#_getIsMounted">getIsMounted</a>() {
</span><span id="93" class="l"><a class="l" href="#93"> 93 </a>        <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;isMounted;
</span><span id="94" class="l"><a class="l" href="#94"> 94 </a>    }
</span><span id="95" class="l"><a class="l" href="#95"> 95 </a>
</span><span id="96" class="l"><a class="l" href="#96"> 96 </a>    <span class="php-comment">/**
</span></span><span id="97" class="l"><a class="l" href="#97"> 97 </a><span class="php-comment">     * Vérifie si le partage est monté et accessible.
</span></span><span id="98" class="l"><a class="l" href="#98"> 98 </a><span class="php-comment">     *
</span></span><span id="99" class="l"><a class="l" href="#99"> 99 </a><span class="php-comment">     * Si le serveur est localhost, on vérifie juste que l'accès est possible.
</span></span><span id="100" class="l"><a class="l" href="#100">100 </a><span class="php-comment">     *
</span></span><span id="101" class="l"><a class="l" href="#101">101 </a><span class="php-comment">     * @return bool
</span></span><span id="102" class="l"><a class="l" href="#102">102 </a><span class="php-comment">     */</span>
</span><span id="103" class="l"><a class="l" href="#103">103 </a>    <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> <a id="_isMounted" href="#_isMounted">isMounted</a>(){
</span><span id="104" class="l"><a class="l" href="#104">104 </a>        <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;server == <span class="php-quote">'localhost'</span>){
</span><span id="105" class="l"><a class="l" href="#105">105 </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">file_exists</span>(<span class="php-var">$this</span>-&gt;path)){
</span><span id="106" class="l"><a class="l" href="#106">106 </a>                <span class="php-var">$this</span>-&gt;isMounted = <span class="php-keyword1">true</span>;
</span><span id="107" class="l"><a class="l" href="#107">107 </a>                <span class="php-keyword1">return</span> <span class="php-keyword1">true</span>;
</span><span id="108" class="l"><a class="l" href="#108">108 </a>            }
</span><span id="109" class="l"><a class="l" href="#109">109 </a>        }<span class="php-keyword1">elseif</span> (<span class="php-keyword2">file_exists</span>(<span class="php-var">$this</span>-&gt;mountName)){
</span><span id="110" class="l"><a class="l" href="#110">110 </a>            <span class="php-comment">/* On teste si ce répertoire est un répertoire vide (non monté)
</span></span><span id="111" class="l"><a class="l" href="#111">111 </a><span class="php-comment">            * Ce qui veut dire que si on monte un partage Windows, il faut s'assurer que celui-ci ne soit pas vide, sans quoi la fonction va retourner une erreur.
</span></span><span id="112" class="l"><a class="l" href="#112">112 </a><span class="php-comment">            */</span>
</span><span id="113" class="l"><a class="l" href="#113">113 </a>            <span class="php-var">$ret</span> = <span class="php-keyword2">exec</span>(<span class="php-quote">'mount | grep '</span>.<span class="php-var">$this</span>-&gt;mountName.<span class="php-quote">' 2&gt;&amp;1'</span>, <span class="php-var">$output</span>);
</span><span id="114" class="l"><a class="l" href="#114">114 </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$ret</span>)){
</span><span id="115" class="l"><a class="l" href="#115">115 </a>                <span class="php-var">$this</span>-&gt;isMounted = <span class="php-keyword1">true</span>;
</span><span id="116" class="l"><a class="l" href="#116">116 </a>                <span class="php-keyword1">return</span> <span class="php-keyword1">true</span>;
</span><span id="117" class="l"><a class="l" href="#117">117 </a>            }
</span><span id="118" class="l"><a class="l" href="#118">118 </a>        }
</span><span id="119" class="l"><a class="l" href="#119">119 </a>        <span class="php-var">$this</span>-&gt;isMounted = <span class="php-keyword1">false</span>;
</span><span id="120" class="l"><a class="l" href="#120">120 </a>        <span class="php-keyword1">return</span> <span class="php-keyword1">false</span>;
</span><span id="121" class="l"><a class="l" href="#121">121 </a>    }
</span><span id="122" class="l"><a class="l" href="#122">122 </a>
</span><span id="123" class="l"><a class="l" href="#123">123 </a>    <span class="php-comment">/**
</span></span><span id="124" class="l"><a class="l" href="#124">124 </a><span class="php-comment">     * Monte le partage SMB
</span></span><span id="125" class="l"><a class="l" href="#125">125 </a><span class="php-comment">     *
</span></span><span id="126" class="l"><a class="l" href="#126">126 </a><span class="php-comment">     * @return bool
</span></span><span id="127" class="l"><a class="l" href="#127">127 </a><span class="php-comment">     */</span>
</span><span id="128" class="l"><a class="l" href="#128">128 </a>    <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> <a id="_mount" href="#_mount">mount</a>(){
</span><span id="129" class="l"><a class="l" href="#129">129 </a>        <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;isMounted()){
</span><span id="130" class="l"><a class="l" href="#130">130 </a>            <span class="php-comment">/* On vérifie que les répertoires sont bien montés sous Linux, et on les monte le cas échéant. */</span>
</span><span id="131" class="l"><a class="l" href="#131">131 </a>            <span class="php-comment">/* Si le répertoire n'est pas créé, on le crée. */</span>
</span><span id="132" class="l"><a class="l" href="#132">132 </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword2">file_exists</span>(<span class="php-var">$this</span>-&gt;mountName)){
</span><span id="133" class="l"><a class="l" href="#133">133 </a>                <span class="php-var">$ret</span> = <span class="php-keyword2">exec</span>(<span class="php-quote">'mkdir '</span>.<span class="php-var">$this</span>-&gt;mountName.<span class="php-quote">' 2&gt;&amp;1'</span>, <span class="php-var">$output</span>);
</span><span id="134" class="l"><a class="l" href="#134">134 </a>                <span class="php-keyword1">if</span> (!<span class="php-keyword2">file_exists</span>(<span class="php-var">$this</span>-&gt;mountName)){
</span><span id="135" class="l"><a class="l" href="#135">135 </a>                    <span class="php-keyword1">new</span> Alert(<span class="php-quote">'error'</span>, <span class="php-quote">'Impossible de créer le point de montage &lt;code&gt;'</span>.<span class="php-var">$this</span>-&gt;mountName.<span class="php-quote">'&lt;/code&gt; pour la raison suivante : &lt;br /&gt;&lt;code&gt;'</span>.<span class="php-var">$ret</span>.<span class="php-quote">'&lt;/code&gt;.&lt;br /&gt;Assurez-vous que le répertoire /mnt est accessible en écriture à tous les utilisateurs Linux, ou que vous avez les droits de créer un répertoire sur le serveur local.'</span>);
</span><span id="136" class="l"><a class="l" href="#136">136 </a>                    <span class="php-keyword1">return</span> <span class="php-keyword1">false</span>;
</span><span id="137" class="l"><a class="l" href="#137">137 </a>                }
</span><span id="138" class="l"><a class="l" href="#138">138 </a>            }
</span><span id="139" class="l"><a class="l" href="#139">139 </a>            <span class="php-comment">/* On regarde si le montage est actif. */</span>
</span><span id="140" class="l"><a class="l" href="#140">140 </a>            <span class="php-var">$ret</span> = <span class="php-keyword2">exec</span>(<span class="php-quote">'mount | grep '</span>.<span class="php-var">$this</span>-&gt;mountName.<span class="php-quote">' 2&gt;&amp;1'</span>, <span class="php-var">$output</span>);
</span><span id="141" class="l"><a class="l" href="#141">141 </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">empty</span>(<span class="php-var">$ret</span>)){
</span><span id="142" class="l"><a class="l" href="#142">142 </a>                <span class="php-comment">/* On monte le partage */</span>
</span><span id="143" class="l"><a class="l" href="#143">143 </a>                <span class="php-var">$share</span> = <span class="php-keyword2">str_replace</span>(<span class="php-quote">':'</span>, <span class="php-quote">'$'</span>, <span class="php-var">$this</span>-&gt;path);
</span><span id="144" class="l"><a class="l" href="#144">144 </a>                <span class="php-var">$share</span> = <span class="php-keyword2">str_replace</span>(<span class="php-quote">'\\'</span>, <span class="php-quote">'/'</span>, <span class="php-var">$share</span>);
</span><span id="145" class="l"><a class="l" href="#145">145 </a>                <span class="php-var">$winShare</span> = <span class="php-quote">'//'</span>.<span class="php-var">$this</span>-&gt;server.<span class="php-quote">'/'</span>.<span class="php-var">$share</span>;
</span><span id="146" class="l"><a class="l" href="#146">146 </a>                <span class="php-var">$cmd</span> = <span class="php-quote">'sudo mount -t cifs &quot;'</span>.<span class="php-var">$winShare</span>.<span class="php-quote">'&quot; '</span>.<span class="php-var">$this</span>-&gt;mountName.<span class="php-quote">' -o uid=administrateur,gid=www-data,credentials=/etc/dfs_creds.conf 2&gt;&amp;1'</span>;
</span><span id="147" class="l"><a class="l" href="#147">147 </a>                <span class="php-var">$ret</span> = <span class="php-keyword2">exec</span>(<span class="php-var">$cmd</span>, <span class="php-var">$retArray</span>, <span class="php-var">$varRet</span>);
</span><span id="148" class="l"><a class="l" href="#148">148 </a>                <span class="php-keyword1">if</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$ret</span>)){
</span><span id="149" class="l"><a class="l" href="#149">149 </a>                    <span class="php-keyword1">new</span> Alert(<span class="php-quote">'error'</span>, <span class="php-quote">'Impossible de monter le partage &lt;code&gt;'</span>.<span class="php-var">$winShare</span>.<span class="php-quote">'&lt;/code&gt;.&lt;br /&gt;Assurez-vous que l\'utilisateur Apache a les droits d\'invoquer sudo mount sans mot de passe.&lt;br /&gt;'</span>.<span class="php-var">$ret</span>.<span class="php-quote">'&lt;br /&gt;'</span>.<span class="php-var">$varRet</span>);
</span><span id="150" class="l"><a class="l" href="#150">150 </a>                    <span class="php-keyword1">return</span> <span class="php-keyword1">false</span>;
</span><span id="151" class="l"><a class="l" href="#151">151 </a>                }
</span><span id="152" class="l"><a class="l" href="#152">152 </a>            }
</span><span id="153" class="l"><a class="l" href="#153">153 </a>        }
</span><span id="154" class="l"><a class="l" href="#154">154 </a>        <span class="php-var">$this</span>-&gt;isMounted = <span class="php-keyword1">true</span>;
</span><span id="155" class="l"><a class="l" href="#155">155 </a>        <span class="php-keyword1">return</span> <span class="php-keyword1">true</span>;
</span><span id="156" class="l"><a class="l" href="#156">156 </a>    }
</span><span id="157" class="l"><a class="l" href="#157">157 </a>
</span><span id="158" class="l"><a class="l" href="#158">158 </a>    <span class="php-comment">/**
</span></span><span id="159" class="l"><a class="l" href="#159">159 </a><span class="php-comment">     * Retourne le contenu récursif d'un répertoire sous forme de tableau
</span></span><span id="160" class="l"><a class="l" href="#160">160 </a><span class="php-comment">     *
</span></span><span id="161" class="l"><a class="l" href="#161">161 </a><span class="php-comment">     * Si $absolutePath est à true, les fichiers sont retournés avec leur chemin absolu dans un tableau séquentiel
</span></span><span id="162" class="l"><a class="l" href="#162">162 </a><span class="php-comment">     * Si $absolutePath est à false (défaut), les fichiers sont retournés dans un tableau associatif dont les clés sont les sous-répertoires
</span></span><span id="163" class="l"><a class="l" href="#163">163 </a><span class="php-comment">     *
</span></span><span id="164" class="l"><a class="l" href="#164">164 </a><span class="php-comment">     * @param string $path Chemin à inventorier dans le chemin de base de l'objet Fs instancié (facultatif)
</span></span><span id="165" class="l"><a class="l" href="#165">165 </a><span class="php-comment">     * @param string $extension Pour ne répertorier que les fichiers ayant une certaine extension (facultatif)
</span></span><span id="166" class="l"><a class="l" href="#166">166 </a><span class="php-comment">     * @param bool   $absolutePath Retourne un tableau à plat avec tous les fichiers, avec leur chemin absolu (facultatif)
</span></span><span id="167" class="l"><a class="l" href="#167">167 </a><span class="php-comment">     *
</span></span><span id="168" class="l"><a class="l" href="#168">168 </a><span class="php-comment">     * @return string[]|array[]
</span></span><span id="169" class="l"><a class="l" href="#169">169 </a><span class="php-comment">     */</span>
</span><span id="170" class="l"><a class="l" href="#170">170 </a>    <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> <a id="_getFilesInDir" href="#_getFilesInDir">getFilesInDir</a>(<span class="php-var">$path</span> = <span class="php-keyword1">null</span>, <span class="php-var">$extension</span> = <span class="php-keyword1">null</span>, <span class="php-var">$absolutePath</span> = <span class="php-keyword1">false</span>){
</span><span id="171" class="l"><a class="l" href="#171">171 </a>        <span class="php-var">$result</span> = <span class="php-keyword1">array</span>();
</span><span id="172" class="l"><a class="l" href="#172">172 </a>        <span class="php-var">$path</span> = <span class="php-keyword2">rtrim</span>(<span class="php-var">$path</span>, DIRECTORY_SEPARATOR).DIRECTORY_SEPARATOR;
</span><span id="173" class="l"><a class="l" href="#173">173 </a>        <span class="php-var">$path</span> = <span class="php-keyword2">ltrim</span>(<span class="php-var">$path</span>, DIRECTORY_SEPARATOR);
</span><span id="174" class="l"><a class="l" href="#174">174 </a>        <span class="php-var">$dir</span> = <span class="php-var">$this</span>-&gt;mountName.DIRECTORY_SEPARATOR.<span class="php-var">$path</span>;
</span><span id="175" class="l"><a class="l" href="#175">175 </a>        <span class="php-var">$cDir</span> = <span class="php-keyword2">scandir</span>(<span class="php-var">$dir</span>);
</span><span id="176" class="l"><a class="l" href="#176">176 </a>        <span class="php-keyword1">foreach</span> (<span class="php-var">$cDir</span> <span class="php-keyword1">as</span> <span class="php-var">$key</span> =&gt; <span class="php-var">$value</span>){
</span><span id="177" class="l"><a class="l" href="#177">177 </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword2">in_array</span>(<span class="php-var">$value</span>,<span class="php-keyword1">array</span>(<span class="php-quote">&quot;.&quot;</span>,<span class="php-quote">&quot;..&quot;</span>))){
</span><span id="178" class="l"><a class="l" href="#178">178 </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">is_dir</span>(<span class="php-var">$dir</span> . <span class="php-var">$value</span>)){
</span><span id="179" class="l"><a class="l" href="#179">179 </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$absolutePath</span>){
</span><span id="180" class="l"><a class="l" href="#180">180 </a>                        <span class="php-var">$result</span> = <span class="php-keyword2">array_merge</span>(<span class="php-var">$this</span>-&gt;getFilesInDir(<span class="php-var">$path</span> . <span class="php-var">$value</span>, <span class="php-var">$extension</span>, <span class="php-var">$absolutePath</span>), <span class="php-var">$result</span>);
</span><span id="181" class="l"><a class="l" href="#181">181 </a>                    }<span class="php-keyword1">else</span>{
</span><span id="182" class="l"><a class="l" href="#182">182 </a>                        <span class="php-var">$result</span>[] = <span class="php-var">$this</span>-&gt;getFilesInDir(<span class="php-var">$path</span> . <span class="php-var">$value</span>, <span class="php-var">$extension</span>, <span class="php-var">$absolutePath</span>);
</span><span id="183" class="l"><a class="l" href="#183">183 </a>                    }
</span><span id="184" class="l"><a class="l" href="#184">184 </a>                }<span class="php-keyword1">else</span>{
</span><span id="185" class="l"><a class="l" href="#185">185 </a>                    <span class="php-keyword1">if</span> ((!<span class="php-keyword1">empty</span>(<span class="php-var">$extension</span>) <span class="php-keyword1">and</span> <span class="php-keyword2">pathinfo</span>(<span class="php-var">$value</span>, PATHINFO_EXTENSION) == <span class="php-var">$extension</span>) <span class="php-keyword1">or</span> <span class="php-keyword1">empty</span>(<span class="php-var">$extension</span>)){
</span><span id="186" class="l"><a class="l" href="#186">186 </a>                        <span class="php-var">$result</span>[] = (<span class="php-var">$absolutePath</span>) ? <span class="php-var">$dir</span>.<span class="php-var">$value</span> : <span class="php-var">$value</span>;
</span><span id="187" class="l"><a class="l" href="#187">187 </a>                    }
</span><span id="188" class="l"><a class="l" href="#188">188 </a>                }
</span><span id="189" class="l"><a class="l" href="#189">189 </a>            }
</span><span id="190" class="l"><a class="l" href="#190">190 </a>        }
</span><span id="191" class="l"><a class="l" href="#191">191 </a>        <span class="php-keyword1">return</span> <span class="php-var">$result</span>;
</span><span id="192" class="l"><a class="l" href="#192">192 </a>    }
</span><span id="193" class="l"><a class="l" href="#193">193 </a>
</span><span id="194" class="l"><a class="l" href="#194">194 </a>    <span class="php-comment">/**
</span></span><span id="195" class="l"><a class="l" href="#195">195 </a><span class="php-comment">     * Vérifie si un fichier existe
</span></span><span id="196" class="l"><a class="l" href="#196">196 </a><span class="php-comment">     *
</span></span><span id="197" class="l"><a class="l" href="#197">197 </a><span class="php-comment">     * @param string $fileName Nom du fichier
</span></span><span id="198" class="l"><a class="l" href="#198">198 </a><span class="php-comment">     *
</span></span><span id="199" class="l"><a class="l" href="#199">199 </a><span class="php-comment">     * @return bool
</span></span><span id="200" class="l"><a class="l" href="#200">200 </a><span class="php-comment">     */</span>
</span><span id="201" class="l"><a class="l" href="#201">201 </a>    <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> <a id="_fileExists" href="#_fileExists">fileExists</a>(<span class="php-var">$fileName</span>){
</span><span id="202" class="l"><a class="l" href="#202">202 </a>        <span class="php-keyword1">return</span> <span class="php-keyword2">file_exists</span>(<span class="php-var">$this</span>-&gt;mountName.DIRECTORY_SEPARATOR.<span class="php-var">$fileName</span>);
</span><span id="203" class="l"><a class="l" href="#203">203 </a>    }
</span><span id="204" class="l"><a class="l" href="#204">204 </a>
</span><span id="205" class="l"><a class="l" href="#205">205 </a>    <span class="php-comment">/**
</span></span><span id="206" class="l"><a class="l" href="#206">206 </a><span class="php-comment">     * Retourne des informations sur un fichier
</span></span><span id="207" class="l"><a class="l" href="#207">207 </a><span class="php-comment">     *
</span></span><span id="208" class="l"><a class="l" href="#208">208 </a><span class="php-comment">     * Cette méthode est lente à exécuter, aussi vaut-il mieux filtrer les champs à retourner afin de n'obtenir que ceux qui seront utilisés.
</span></span><span id="209" class="l"><a class="l" href="#209">209 </a><span class="php-comment">     *
</span></span><span id="210" class="l"><a class="l" href="#210">210 </a><span class="php-comment">     * Propriétés retournées :
</span></span><span id="211" class="l"><a class="l" href="#211">211 </a><span class="php-comment">     * - dateCreated
</span></span><span id="212" class="l"><a class="l" href="#212">212 </a><span class="php-comment">     * - dateModified
</span></span><span id="213" class="l"><a class="l" href="#213">213 </a><span class="php-comment">     * - size
</span></span><span id="214" class="l"><a class="l" href="#214">214 </a><span class="php-comment">     * - extension
</span></span><span id="215" class="l"><a class="l" href="#215">215 </a><span class="php-comment">     * - type
</span></span><span id="216" class="l"><a class="l" href="#216">216 </a><span class="php-comment">     * - chmod
</span></span><span id="217" class="l"><a class="l" href="#217">217 </a><span class="php-comment">     * - writable
</span></span><span id="218" class="l"><a class="l" href="#218">218 </a><span class="php-comment">     * - owner
</span></span><span id="219" class="l"><a class="l" href="#219">219 </a><span class="php-comment">     * - groupOwner
</span></span><span id="220" class="l"><a class="l" href="#220">220 </a><span class="php-comment">     *
</span></span><span id="221" class="l"><a class="l" href="#221">221 </a><span class="php-comment">     * @param string $fileName Nom du fichier
</span></span><span id="222" class="l"><a class="l" href="#222">222 </a><span class="php-comment">     * @param string[]|string  $filters Filtres facultatifs sous forme de chaîne ou de tableau séquentiel (facultatif)
</span></span><span id="223" class="l"><a class="l" href="#223">223 </a><span class="php-comment">     *
</span></span><span id="224" class="l"><a class="l" href="#224">224 </a><span class="php-comment">     * @return bool|object
</span></span><span id="225" class="l"><a class="l" href="#225">225 </a><span class="php-comment">     */</span>
</span><span id="226" class="l"><a class="l" href="#226">226 </a>    <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> <a id="_getFileMeta" href="#_getFileMeta">getFileMeta</a>(<span class="php-var">$fileName</span>, <span class="php-var">$filters</span> = <span class="php-keyword1">array</span>()){
</span><span id="227" class="l"><a class="l" href="#227">227 </a>        <span class="php-keyword1">if</span> (!<span class="php-keyword2">is_array</span>(<span class="php-var">$filters</span>)){
</span><span id="228" class="l"><a class="l" href="#228">228 </a>            <span class="php-var">$filters</span> = <span class="php-keyword1">array</span>(<span class="php-var">$filters</span>);
</span><span id="229" class="l"><a class="l" href="#229">229 </a>        }
</span><span id="230" class="l"><a class="l" href="#230">230 </a>        <span class="php-var">$meta</span> = <span class="php-keyword1">new</span> stdClass;
</span><span id="231" class="l"><a class="l" href="#231">231 </a>        <span class="php-comment">/*$meta-&gt;dateCreated = 0;
</span></span><span id="232" class="l"><a class="l" href="#232">232 </a><span class="php-comment">        $meta-&gt;dateModified = 0;
</span></span><span id="233" class="l"><a class="l" href="#233">233 </a><span class="php-comment">        $meta-&gt;size = 0;
</span></span><span id="234" class="l"><a class="l" href="#234">234 </a><span class="php-comment">        $meta-&gt;extension = null;
</span></span><span id="235" class="l"><a class="l" href="#235">235 </a><span class="php-comment">        $meta-&gt;type = null;
</span></span><span id="236" class="l"><a class="l" href="#236">236 </a><span class="php-comment">        $meta-&gt;chmod = null;
</span></span><span id="237" class="l"><a class="l" href="#237">237 </a><span class="php-comment">        $meta-&gt;writable = false;
</span></span><span id="238" class="l"><a class="l" href="#238">238 </a><span class="php-comment">        $meta-&gt;owner = null;
</span></span><span id="239" class="l"><a class="l" href="#239">239 </a><span class="php-comment">        $meta-&gt;groupOwner = null;*/</span>
</span><span id="240" class="l"><a class="l" href="#240">240 </a>        <span class="php-var">$file</span> = <span class="php-var">$this</span>-&gt;mountName.DIRECTORY_SEPARATOR. <span class="php-var">$fileName</span>;
</span><span id="241" class="l"><a class="l" href="#241">241 </a>        <span class="php-keyword1">if</span> (!<span class="php-keyword2">file_exists</span>(<span class="php-var">$file</span>)){
</span><span id="242" class="l"><a class="l" href="#242">242 </a>            <span class="php-keyword1">new</span> Alert(<span class="php-quote">'debug'</span>, <span class="php-quote">'&lt;code&gt;Fs-&gt;fileMeta()&lt;/code&gt; : Le fichier &lt;code&gt;'</span>.<span class="php-var">$file</span>.<span class="php-quote">'&lt;/code&gt; n\'existe pas !'</span>);
</span><span id="243" class="l"><a class="l" href="#243">243 </a>            <span class="php-keyword1">return</span> <span class="php-keyword1">false</span>;
</span><span id="244" class="l"><a class="l" href="#244">244 </a>        }
</span><span id="245" class="l"><a class="l" href="#245">245 </a>        <span class="php-keyword1">if</span> ((!<span class="php-keyword1">empty</span>(<span class="php-var">$filters</span>) <span class="php-keyword1">and</span> (<span class="php-keyword2">in_array</span>(<span class="php-quote">'dateCreated'</span>, <span class="php-var">$filters</span>) <span class="php-keyword1">or</span> <span class="php-keyword2">in_array</span>(<span class="php-quote">'dateModified'</span>, <span class="php-var">$filters</span>) <span class="php-keyword1">or</span> <span class="php-keyword2">in_array</span>(<span class="php-quote">'size'</span>, <span class="php-var">$filters</span>))) <span class="php-keyword1">or</span> <span class="php-keyword1">empty</span>(<span class="php-var">$filters</span>)){
</span><span id="246" class="l"><a class="l" href="#246">246 </a>            <span class="php-var">$stat</span> = <span class="php-keyword2">stat</span>(<span class="php-var">$file</span>);
</span><span id="247" class="l"><a class="l" href="#247">247 </a>            <span class="php-var">$meta</span>-&gt;dateCreated = <span class="php-var">$stat</span>[<span class="php-quote">'ctime'</span>];
</span><span id="248" class="l"><a class="l" href="#248">248 </a>            <span class="php-var">$meta</span>-&gt;dateModified = <span class="php-var">$stat</span>[<span class="php-quote">'mtime'</span>];
</span><span id="249" class="l"><a class="l" href="#249">249 </a>            <span class="php-var">$meta</span>-&gt;size = <span class="php-var">$stat</span>[<span class="php-quote">'size'</span>];
</span><span id="250" class="l"><a class="l" href="#250">250 </a>        }
</span><span id="251" class="l"><a class="l" href="#251">251 </a>        <span class="php-keyword1">if</span> ((!<span class="php-keyword1">empty</span>(<span class="php-var">$filters</span>) <span class="php-keyword1">and</span> <span class="php-keyword2">in_array</span>(<span class="php-quote">'extension'</span>, <span class="php-var">$filters</span>)) <span class="php-keyword1">or</span> <span class="php-keyword1">empty</span>(<span class="php-var">$filters</span>)){
</span><span id="252" class="l"><a class="l" href="#252">252 </a>            <span class="php-var">$meta</span>-&gt;extension = <span class="php-keyword2">pathinfo</span>(<span class="php-var">$fileName</span>, PATHINFO_EXTENSION);
</span><span id="253" class="l"><a class="l" href="#253">253 </a>        }
</span><span id="254" class="l"><a class="l" href="#254">254 </a>        <span class="php-keyword1">if</span> ((!<span class="php-keyword1">empty</span>(<span class="php-var">$filters</span>) <span class="php-keyword1">and</span> <span class="php-keyword2">in_array</span>(<span class="php-quote">'type'</span>, <span class="php-var">$filters</span>)) <span class="php-keyword1">or</span> <span class="php-keyword1">empty</span>(<span class="php-var">$filters</span>)){
</span><span id="255" class="l"><a class="l" href="#255">255 </a>            <span class="php-var">$meta</span>-&gt;type = <span class="php-keyword2">mime_content_type</span>(<span class="php-var">$file</span>);
</span><span id="256" class="l"><a class="l" href="#256">256 </a>        }
</span><span id="257" class="l"><a class="l" href="#257">257 </a>        <span class="php-keyword1">if</span> ((!<span class="php-keyword1">empty</span>(<span class="php-var">$filters</span>) <span class="php-keyword1">and</span> <span class="php-keyword2">in_array</span>(<span class="php-quote">'chmod'</span>, <span class="php-var">$filters</span>)) <span class="php-keyword1">or</span> <span class="php-keyword1">empty</span>(<span class="php-var">$filters</span>)){
</span><span id="258" class="l"><a class="l" href="#258">258 </a>            <span class="php-var">$meta</span>-&gt;<span class="php-keyword2">chmod</span> = (int)<span class="php-keyword2">decoct</span>(<span class="php-keyword2">fileperms</span>(<span class="php-var">$file</span>) &amp; <span class="php-num">0777</span>);
</span><span id="259" class="l"><a class="l" href="#259">259 </a>            <span class="php-var">$meta</span>-&gt;advChmod = (int)<span class="php-keyword2">substr</span>(<span class="php-keyword2">decoct</span>(<span class="php-keyword2">fileperms</span>(<span class="php-var">$file</span>)),<span class="php-num">2</span>);
</span><span id="260" class="l"><a class="l" href="#260">260 </a>        }
</span><span id="261" class="l"><a class="l" href="#261">261 </a>        <span class="php-keyword1">if</span> ((!<span class="php-keyword1">empty</span>(<span class="php-var">$filters</span>) <span class="php-keyword1">and</span> <span class="php-keyword2">in_array</span>(<span class="php-quote">'writable'</span>, <span class="php-var">$filters</span>)) <span class="php-keyword1">or</span> <span class="php-keyword1">empty</span>(<span class="php-var">$filters</span>)){
</span><span id="262" class="l"><a class="l" href="#262">262 </a>            <span class="php-var">$meta</span>-&gt;writable = <span class="php-keyword2">is_writable</span>(<span class="php-var">$file</span>);
</span><span id="263" class="l"><a class="l" href="#263">263 </a>        }
</span><span id="264" class="l"><a class="l" href="#264">264 </a>        <span class="php-keyword1">if</span> ((!<span class="php-keyword1">empty</span>(<span class="php-var">$filters</span>) <span class="php-keyword1">and</span> <span class="php-keyword2">in_array</span>(<span class="php-quote">'owner'</span>, <span class="php-var">$filters</span>)) <span class="php-keyword1">or</span> <span class="php-keyword1">empty</span>(<span class="php-var">$filters</span>)){
</span><span id="265" class="l"><a class="l" href="#265">265 </a>            <span class="php-var">$meta</span>-&gt;owner = <span class="php-keyword2">posix_getpwuid</span>(<span class="php-keyword2">fileowner</span>(<span class="php-var">$file</span>))[<span class="php-quote">'name'</span>];
</span><span id="266" class="l"><a class="l" href="#266">266 </a>        }
</span><span id="267" class="l"><a class="l" href="#267">267 </a>        <span class="php-keyword1">if</span> ((!<span class="php-keyword1">empty</span>(<span class="php-var">$filters</span>) <span class="php-keyword1">and</span> <span class="php-keyword2">in_array</span>(<span class="php-quote">'groupOwner'</span>, <span class="php-var">$filters</span>)) <span class="php-keyword1">or</span> <span class="php-keyword1">empty</span>(<span class="php-var">$filters</span>)){
</span><span id="268" class="l"><a class="l" href="#268">268 </a>            <span class="php-var">$meta</span>-&gt;groupOwner = <span class="php-keyword2">posix_getgrgid</span>(<span class="php-keyword2">filegroup</span>(<span class="php-var">$file</span>))[<span class="php-quote">'name'</span>];
</span><span id="269" class="l"><a class="l" href="#269">269 </a>        }
</span><span id="270" class="l"><a class="l" href="#270">270 </a>        <span class="php-keyword1">return</span> <span class="php-var">$meta</span>;
</span><span id="271" class="l"><a class="l" href="#271">271 </a>    }
</span><span id="272" class="l"><a class="l" href="#272">272 </a>
</span><span id="273" class="l"><a class="l" href="#273">273 </a>    <span class="php-comment">/**
</span></span><span id="274" class="l"><a class="l" href="#274">274 </a><span class="php-comment">     * Lit un fichier
</span></span><span id="275" class="l"><a class="l" href="#275">275 </a><span class="php-comment">     *
</span></span><span id="276" class="l"><a class="l" href="#276">276 </a><span class="php-comment">     * @param string $fileName Nom du fichier
</span></span><span id="277" class="l"><a class="l" href="#277">277 </a><span class="php-comment">     * @param string $format Format de retour (array ou string) - par défaut, renvoie toutes les lignes dans un tableau (facultatif)
</span></span><span id="278" class="l"><a class="l" href="#278">278 </a><span class="php-comment">     * @param bool   $ignoreNewLines N'ajoute pas les caractères de passage à la ligne à la fin de chaque ligne dans le tableau retourné (facultatif)
</span></span><span id="279" class="l"><a class="l" href="#279">279 </a><span class="php-comment">     * @param bool   $skipEmptyLines Ignore les lignes vides (désactivé par défaut) (facultatif)
</span></span><span id="280" class="l"><a class="l" href="#280">280 </a><span class="php-comment">     *
</span></span><span id="281" class="l"><a class="l" href="#281">281 </a><span class="php-comment">     * @return string[]|string|bool renvoie le fichier dans le format de demandé, ou false en cas d'erreur
</span></span><span id="282" class="l"><a class="l" href="#282">282 </a><span class="php-comment">     */</span>
</span><span id="283" class="l"><a class="l" href="#283">283 </a>    <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> <span class="php-keyword2">readFile</span>(<span class="php-var">$fileName</span>, <span class="php-var">$format</span> = <span class="php-quote">'array'</span>, <span class="php-var">$ignoreNewLines</span> = <span class="php-keyword1">true</span>, <span class="php-var">$skipEmptyLines</span> = <span class="php-keyword1">false</span>){
</span><span id="284" class="l"><a class="l" href="#284">284 </a>        <span class="php-var">$opt</span> = <span class="php-keyword1">null</span>;
</span><span id="285" class="l"><a class="l" href="#285">285 </a>        <span class="php-keyword1">if</span> (<span class="php-var">$ignoreNewLines</span> <span class="php-keyword1">and</span> <span class="php-var">$skipEmptyLines</span>){
</span><span id="286" class="l"><a class="l" href="#286">286 </a>            <span class="php-var">$opt</span> = FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES;
</span><span id="287" class="l"><a class="l" href="#287">287 </a>        }<span class="php-keyword1">elseif</span>(<span class="php-var">$ignoreNewLines</span>){
</span><span id="288" class="l"><a class="l" href="#288">288 </a>            <span class="php-var">$opt</span> = FILE_IGNORE_NEW_LINES;
</span><span id="289" class="l"><a class="l" href="#289">289 </a>        }<span class="php-keyword1">elseif</span>(<span class="php-var">$skipEmptyLines</span>){
</span><span id="290" class="l"><a class="l" href="#290">290 </a>            <span class="php-var">$opt</span> = FILE_SKIP_EMPTY_LINES;
</span><span id="291" class="l"><a class="l" href="#291">291 </a>        }
</span><span id="292" class="l"><a class="l" href="#292">292 </a>        <span class="php-keyword1">switch</span> (<span class="php-var">$format</span>){
</span><span id="293" class="l"><a class="l" href="#293">293 </a>            <span class="php-keyword1">case</span> <span class="php-quote">'array'</span>:
</span><span id="294" class="l"><a class="l" href="#294">294 </a>                <span class="php-var">$file</span>=@<span class="php-keyword2">file</span>(<span class="php-var">$this</span>-&gt;mountName . DIRECTORY_SEPARATOR . <span class="php-var">$fileName</span>, <span class="php-var">$opt</span> );
</span><span id="295" class="l"><a class="l" href="#295">295 </a>                <span class="php-keyword1">break</span>;
</span><span id="296" class="l"><a class="l" href="#296">296 </a>            <span class="php-keyword1">case</span> <span class="php-quote">'string'</span>:
</span><span id="297" class="l"><a class="l" href="#297">297 </a>                <span class="php-var">$file</span> = <span class="php-keyword2">file_get_contents</span>(<span class="php-var">$this</span>-&gt;mountName . DIRECTORY_SEPARATOR . <span class="php-var">$fileName</span>);
</span><span id="298" class="l"><a class="l" href="#298">298 </a>                <span class="php-keyword1">break</span>;
</span><span id="299" class="l"><a class="l" href="#299">299 </a>            <span class="php-keyword1">default</span>:
</span><span id="300" class="l"><a class="l" href="#300">300 </a>                <span class="php-keyword1">new</span> Alert(<span class="php-quote">'debug'</span>, <span class="php-quote">'&lt;code&gt;FileSytem\Fs-&gt;fileRead()&lt;/code&gt; : Le format &lt;code&gt;'</span>.<span class="php-var">$format</span>.<span class="php-quote">'&lt;/code&gt; n\'est pas dans la liste des formats autorisés !'</span>);
</span><span id="301" class="l"><a class="l" href="#301">301 </a>                <span class="php-keyword1">return</span> <span class="php-keyword1">false</span>;
</span><span id="302" class="l"><a class="l" href="#302">302 </a>        }
</span><span id="303" class="l"><a class="l" href="#303">303 </a>        <span class="php-keyword1">if</span> (<span class="php-var">$file</span> === <span class="php-keyword1">false</span>){
</span><span id="304" class="l"><a class="l" href="#304">304 </a>            <span class="php-keyword1">new</span> Alert(<span class="php-quote">'error'</span>, <span class="php-quote">'Impossible de lire le fichier &lt;code&gt;'</span>.<span class="php-var">$fileName</span>.<span class="php-quote">'&lt;/code&gt; !'</span>);
</span><span id="305" class="l"><a class="l" href="#305">305 </a>            <span class="php-keyword1">return</span> <span class="php-keyword1">false</span>;
</span><span id="306" class="l"><a class="l" href="#306">306 </a>        }
</span><span id="307" class="l"><a class="l" href="#307">307 </a>        <span class="php-keyword1">return</span> <span class="php-var">$file</span>;
</span><span id="308" class="l"><a class="l" href="#308">308 </a>    }
</span><span id="309" class="l"><a class="l" href="#309">309 </a>
</span><span id="310" class="l"><a class="l" href="#310">310 </a>    <span class="php-comment">/**
</span></span><span id="311" class="l"><a class="l" href="#311">311 </a><span class="php-comment">     * Crée un fichier si celui-ci n'existe pas
</span></span><span id="312" class="l"><a class="l" href="#312">312 </a><span class="php-comment">     *
</span></span><span id="313" class="l"><a class="l" href="#313">313 </a><span class="php-comment">     * La date de modification du fichier sera modifiée à l'heure actuelle si celui-ci existe
</span></span><span id="314" class="l"><a class="l" href="#314">314 </a><span class="php-comment">     * @param string $fileName Nom du fichier à créer si inexistant
</span></span><span id="315" class="l"><a class="l" href="#315">315 </a><span class="php-comment">     *
</span></span><span id="316" class="l"><a class="l" href="#316">316 </a><span class="php-comment">     * @return bool
</span></span><span id="317" class="l"><a class="l" href="#317">317 </a><span class="php-comment">     */</span>
</span><span id="318" class="l"><a class="l" href="#318">318 </a>    <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> <a id="_touchFile" href="#_touchFile">touchFile</a>(<span class="php-var">$fileName</span>){
</span><span id="319" class="l"><a class="l" href="#319">319 </a>        <span class="php-var">$ret</span> = <span class="php-keyword2">touch</span>(<span class="php-var">$this</span>-&gt;mountName . DIRECTORY_SEPARATOR .<span class="php-var">$fileName</span>);
</span><span id="320" class="l"><a class="l" href="#320">320 </a>        <span class="php-keyword1">if</span> (!<span class="php-var">$ret</span>) <span class="php-keyword1">new</span> Alert(<span class="php-quote">'error'</span>, <span class="php-quote">'Impossible de trouver ou de créer le fichier &lt;code&gt;'</span>.<span class="php-var">$fileName</span>.<span class="php-quote">'&lt;/code&gt;'</span>);
</span><span id="321" class="l"><a class="l" href="#321">321 </a>        <span class="php-keyword1">return</span> <span class="php-var">$ret</span>;
</span><span id="322" class="l"><a class="l" href="#322">322 </a>    }
</span><span id="323" class="l"><a class="l" href="#323">323 </a>
</span><span id="324" class="l"><a class="l" href="#324">324 </a>    <span class="php-comment">/**
</span></span><span id="325" class="l"><a class="l" href="#325">325 </a><span class="php-comment">     * Ecrit dans un fichier
</span></span><span id="326" class="l"><a class="l" href="#326">326 </a><span class="php-comment">     *
</span></span><span id="327" class="l"><a class="l" href="#327">327 </a><span class="php-comment">     * @param string       $fileName Nom du fichier
</span></span><span id="328" class="l"><a class="l" href="#328">328 </a><span class="php-comment">     * @param array|string $content Contenu du fichier
</span></span><span id="329" class="l"><a class="l" href="#329">329 </a><span class="php-comment">     * @param bool         $append Ajoute le contenu à la suite du fichier au lieu de l'écraser si celui-ci existe (facultatif)
</span></span><span id="330" class="l"><a class="l" href="#330">330 </a><span class="php-comment">     * @param bool         $backupFile Crée un backup du fichier avec l'extension .backup (facultatif)
</span></span><span id="331" class="l"><a class="l" href="#331">331 </a><span class="php-comment">     *
</span></span><span id="332" class="l"><a class="l" href="#332">332 </a><span class="php-comment">     * @return bool
</span></span><span id="333" class="l"><a class="l" href="#333">333 </a><span class="php-comment">     */</span>
</span><span id="334" class="l"><a class="l" href="#334">334 </a>    <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> <a id="_writeFile" href="#_writeFile">writeFile</a>(<span class="php-var">$fileName</span>, <span class="php-var">$content</span>, <span class="php-var">$append</span> = <span class="php-keyword1">false</span>, <span class="php-var">$backupFile</span> = <span class="php-keyword1">false</span>){
</span><span id="335" class="l"><a class="l" href="#335">335 </a>        <span class="php-keyword1">if</span> (<span class="php-var">$backupFile</span>){
</span><span id="336" class="l"><a class="l" href="#336">336 </a>            <span class="php-keyword1">if</span> (!@<span class="php-keyword2">copy</span>(<span class="php-var">$this</span>-&gt;mountName . DIRECTORY_SEPARATOR . <span class="php-var">$fileName</span>, <span class="php-var">$this</span>-&gt;mountName . DIRECTORY_SEPARATOR . <span class="php-var">$fileName</span>.<span class="php-quote">'.backup'</span>)){
</span><span id="337" class="l"><a class="l" href="#337">337 </a>                <span class="php-var">$error</span>= <span class="php-keyword2">error_get_last</span>();
</span><span id="338" class="l"><a class="l" href="#338">338 </a>                <span class="php-keyword1">new</span> Alert(<span class="php-quote">'error'</span>, <span class="php-quote">'Impossible de faire un backup du fichier &lt;code&gt;'</span>.<span class="php-var">$fileName</span>.<span class="php-quote">'&lt;/code&gt; !&lt;br&gt;'</span>.<span class="php-var">$error</span>[<span class="php-quote">'message'</span>]);
</span><span id="339" class="l"><a class="l" href="#339">339 </a>                <span class="php-keyword1">return</span> <span class="php-keyword1">false</span>;
</span><span id="340" class="l"><a class="l" href="#340">340 </a>            }
</span><span id="341" class="l"><a class="l" href="#341">341 </a>        }
</span><span id="342" class="l"><a class="l" href="#342">342 </a>        <span class="php-comment">// N'oublions pas les retours à la ligne à la fin de chaque ligne.</span>
</span><span id="343" class="l"><a class="l" href="#343">343 </a>        <span class="php-keyword1">if</span> (<span class="php-keyword2">is_array</span>(<span class="php-var">$content</span>)){
</span><span id="344" class="l"><a class="l" href="#344">344 </a>        <span class="php-keyword2">array_walk</span>(<span class="php-var">$content</span>, <span class="php-keyword1">function</span>(&amp;<span class="php-var">$value</span>){
</span><span id="345" class="l"><a class="l" href="#345">345 </a>            <span class="php-var">$value</span> .= <span class="php-quote">&quot;\r\n&quot;</span>;
</span><span id="346" class="l"><a class="l" href="#346">346 </a>        });
</span><span id="347" class="l"><a class="l" href="#347">347 </a>        }<span class="php-keyword1">else</span>{
</span><span id="348" class="l"><a class="l" href="#348">348 </a>            <span class="php-var">$content</span> .= <span class="php-quote">&quot;\r\n&quot;</span>;
</span><span id="349" class="l"><a class="l" href="#349">349 </a>        }
</span><span id="350" class="l"><a class="l" href="#350">350 </a>        <span class="php-var">$fileAppend</span> = (<span class="php-var">$append</span>) ? FILE_APPEND : <span class="php-keyword1">null</span>;
</span><span id="351" class="l"><a class="l" href="#351">351 </a>        <span class="php-var">$ret</span> = <span class="php-keyword2">file_put_contents</span>(<span class="php-var">$this</span>-&gt;mountName . DIRECTORY_SEPARATOR . <span class="php-var">$fileName</span>, <span class="php-var">$content</span>, <span class="php-var">$fileAppend</span>);
</span><span id="352" class="l"><a class="l" href="#352">352 </a>        <span class="php-keyword1">if</span> (<span class="php-var">$ret</span> === <span class="php-keyword1">false</span>){
</span><span id="353" class="l"><a class="l" href="#353">353 </a>            <span class="php-keyword1">new</span> Alert(<span class="php-quote">'error'</span>, <span class="php-quote">'Impossible d\'écrire dans le fichier &lt;code&gt;'</span>.<span class="php-var">$fileName</span>.<span class="php-quote">'&lt;/code&gt; !'</span>);
</span><span id="354" class="l"><a class="l" href="#354">354 </a>            <span class="php-keyword1">return</span> <span class="php-keyword1">false</span>;
</span><span id="355" class="l"><a class="l" href="#355">355 </a>        }
</span><span id="356" class="l"><a class="l" href="#356">356 </a>        <span class="php-keyword1">new</span> Alert(<span class="php-quote">'success'</span>, <span class="php-quote">'Les modifications ont été enregistrées dans le fichier &lt;code&gt;'</span>.<span class="php-var">$fileName</span>.<span class="php-quote">'&lt;/code&gt;'</span>);
</span><span id="357" class="l"><a class="l" href="#357">357 </a>        <span class="php-keyword1">return</span> <span class="php-keyword1">true</span>;
</span><span id="358" class="l"><a class="l" href="#358">358 </a>    }
</span><span id="359" class="l"><a class="l" href="#359">359 </a>
</span><span id="360" class="l"><a class="l" href="#360">360 </a>    <span class="php-comment">/**
</span></span><span id="361" class="l"><a class="l" href="#361">361 </a><span class="php-comment">     * Lit les x dernières lignes d'un fichier
</span></span><span id="362" class="l"><a class="l" href="#362">362 </a><span class="php-comment">     *
</span></span><span id="363" class="l"><a class="l" href="#363">363 </a><span class="php-comment">     * @from &lt;http://stackoverflow.com/questions/15025875/what-is-the-best-way-in-php-to-read-last-lines-from-a-file/15025877#15025877&gt;
</span></span><span id="364" class="l"><a class="l" href="#364">364 </a><span class="php-comment">     * @param string $fileName Nom du fichier
</span></span><span id="365" class="l"><a class="l" href="#365">365 </a><span class="php-comment">     * @param int  $lines Nombre de lignes à retourner (facultatif)
</span></span><span id="366" class="l"><a class="l" href="#366">366 </a><span class="php-comment">     * @param bool $adaptive (facultatif)
</span></span><span id="367" class="l"><a class="l" href="#367">367 </a><span class="php-comment">     *
</span></span><span id="368" class="l"><a class="l" href="#368">368 </a><span class="php-comment">     * @return bool|string[]
</span></span><span id="369" class="l"><a class="l" href="#369">369 </a><span class="php-comment">     */</span>
</span><span id="370" class="l"><a class="l" href="#370">370 </a>    <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> <a id="_tailFile" href="#_tailFile">tailFile</a>(<span class="php-var">$fileName</span>, <span class="php-var">$lines</span> = <span class="php-num">1</span>, <span class="php-var">$adaptive</span> = <span class="php-keyword1">true</span>) {
</span><span id="371" class="l"><a class="l" href="#371">371 </a>        <span class="php-comment">// Open file</span>
</span><span id="372" class="l"><a class="l" href="#372">372 </a>        <span class="php-var">$f</span> = @<span class="php-keyword2">fopen</span>(<span class="php-var">$this</span>-&gt;mountName . DIRECTORY_SEPARATOR . <span class="php-var">$fileName</span>, <span class="php-quote">&quot;rb&quot;</span>);
</span><span id="373" class="l"><a class="l" href="#373">373 </a>        <span class="php-keyword1">if</span> (<span class="php-var">$f</span> === <span class="php-keyword1">false</span>){
</span><span id="374" class="l"><a class="l" href="#374">374 </a>            <span class="php-keyword1">new</span> Alert(<span class="php-quote">'error'</span>, <span class="php-quote">'Impossible d\'ouvrir le fichier &lt;code&gt;'</span>.<span class="php-var">$fileName</span>.<span class="php-quote">'&lt;/code&gt; !'</span>);
</span><span id="375" class="l"><a class="l" href="#375">375 </a>            <span class="php-keyword1">return</span> <span class="php-keyword1">false</span>;
</span><span id="376" class="l"><a class="l" href="#376">376 </a>        }
</span><span id="377" class="l"><a class="l" href="#377">377 </a>
</span><span id="378" class="l"><a class="l" href="#378">378 </a>        <span class="php-comment">// Sets buffer size</span>
</span><span id="379" class="l"><a class="l" href="#379">379 </a>        <span class="php-keyword1">if</span> (!<span class="php-var">$adaptive</span>) <span class="php-var">$buffer</span> = <span class="php-num">4096</span>;
</span><span id="380" class="l"><a class="l" href="#380">380 </a>        <span class="php-keyword1">else</span> <span class="php-var">$buffer</span> = (<span class="php-var">$lines</span> &lt; <span class="php-num">2</span> ? <span class="php-num">64</span> : (<span class="php-var">$lines</span> &lt; <span class="php-num">10</span> ? <span class="php-num">512</span> : <span class="php-num">4096</span>));
</span><span id="381" class="l"><a class="l" href="#381">381 </a>
</span><span id="382" class="l"><a class="l" href="#382">382 </a>        <span class="php-comment">// Jump to last character</span>
</span><span id="383" class="l"><a class="l" href="#383">383 </a>        <span class="php-keyword2">fseek</span>(<span class="php-var">$f</span>, -<span class="php-num">1</span>, SEEK_END);
</span><span id="384" class="l"><a class="l" href="#384">384 </a>
</span><span id="385" class="l"><a class="l" href="#385">385 </a>        <span class="php-comment">// Read it and adjust line number if necessary</span>
</span><span id="386" class="l"><a class="l" href="#386">386 </a>        <span class="php-comment">// (Otherwise the result would be wrong if file doesn't end with a blank line)</span>
</span><span id="387" class="l"><a class="l" href="#387">387 </a>        <span class="php-keyword1">if</span> (<span class="php-keyword2">fread</span>(<span class="php-var">$f</span>, <span class="php-num">1</span>) != <span class="php-quote">&quot;\n&quot;</span>) <span class="php-var">$lines</span> -= <span class="php-num">1</span>;
</span><span id="388" class="l"><a class="l" href="#388">388 </a>
</span><span id="389" class="l"><a class="l" href="#389">389 </a>        <span class="php-comment">// Start reading</span>
</span><span id="390" class="l"><a class="l" href="#390">390 </a>        <span class="php-var">$output</span> = <span class="php-quote">''</span>;
</span><span id="391" class="l"><a class="l" href="#391">391 </a>        <span class="php-var">$chunk</span> = <span class="php-quote">''</span>;
</span><span id="392" class="l"><a class="l" href="#392">392 </a>
</span><span id="393" class="l"><a class="l" href="#393">393 </a>        <span class="php-comment">// While we would like more</span>
</span><span id="394" class="l"><a class="l" href="#394">394 </a>        <span class="php-keyword1">while</span> (<span class="php-keyword2">ftell</span>(<span class="php-var">$f</span>) &gt; <span class="php-num">0</span> &amp;&amp; <span class="php-var">$lines</span> &gt;= <span class="php-num">0</span>) {
</span><span id="395" class="l"><a class="l" href="#395">395 </a>
</span><span id="396" class="l"><a class="l" href="#396">396 </a>            <span class="php-comment">// Figure out how far back we should jump</span>
</span><span id="397" class="l"><a class="l" href="#397">397 </a>            <span class="php-var">$seek</span> = <span class="php-keyword2">min</span>(<span class="php-keyword2">ftell</span>(<span class="php-var">$f</span>), <span class="php-var">$buffer</span>);
</span><span id="398" class="l"><a class="l" href="#398">398 </a>
</span><span id="399" class="l"><a class="l" href="#399">399 </a>            <span class="php-comment">// Do the jump (backwards, relative to where we are)</span>
</span><span id="400" class="l"><a class="l" href="#400">400 </a>            <span class="php-keyword2">fseek</span>(<span class="php-var">$f</span>, -<span class="php-var">$seek</span>, SEEK_CUR);
</span><span id="401" class="l"><a class="l" href="#401">401 </a>
</span><span id="402" class="l"><a class="l" href="#402">402 </a>            <span class="php-comment">// Read a chunk and prepend it to our output</span>
</span><span id="403" class="l"><a class="l" href="#403">403 </a>            <span class="php-var">$output</span> = (<span class="php-var">$chunk</span> = <span class="php-keyword2">fread</span>(<span class="php-var">$f</span>, <span class="php-var">$seek</span>)) . <span class="php-var">$output</span>;
</span><span id="404" class="l"><a class="l" href="#404">404 </a>
</span><span id="405" class="l"><a class="l" href="#405">405 </a>            <span class="php-comment">// Jump back to where we started reading</span>
</span><span id="406" class="l"><a class="l" href="#406">406 </a>            <span class="php-keyword2">fseek</span>(<span class="php-var">$f</span>, -<span class="php-keyword2">mb_strlen</span>(<span class="php-var">$chunk</span>, <span class="php-quote">'8bit'</span>), SEEK_CUR);
</span><span id="407" class="l"><a class="l" href="#407">407 </a>
</span><span id="408" class="l"><a class="l" href="#408">408 </a>            <span class="php-comment">// Decrease our line counter</span>
</span><span id="409" class="l"><a class="l" href="#409">409 </a>            <span class="php-var">$lines</span> -= <span class="php-keyword2">substr_count</span>(<span class="php-var">$chunk</span>, <span class="php-quote">&quot;\n&quot;</span>);
</span><span id="410" class="l"><a class="l" href="#410">410 </a>
</span><span id="411" class="l"><a class="l" href="#411">411 </a>        }
</span><span id="412" class="l"><a class="l" href="#412">412 </a>
</span><span id="413" class="l"><a class="l" href="#413">413 </a>        <span class="php-comment">// While we have too many lines</span>
</span><span id="414" class="l"><a class="l" href="#414">414 </a>        <span class="php-comment">// (Because of buffer size we might have read too many)</span>
</span><span id="415" class="l"><a class="l" href="#415">415 </a>        <span class="php-keyword1">while</span> (<span class="php-var">$lines</span>++ &lt; <span class="php-num">0</span>) {
</span><span id="416" class="l"><a class="l" href="#416">416 </a>
</span><span id="417" class="l"><a class="l" href="#417">417 </a>            <span class="php-comment">// Find first newline and remove all text before that</span>
</span><span id="418" class="l"><a class="l" href="#418">418 </a>            <span class="php-var">$output</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$output</span>, <span class="php-keyword2">strpos</span>(<span class="php-var">$output</span>, <span class="php-quote">&quot;\n&quot;</span>) + <span class="php-num">1</span>);
</span><span id="419" class="l"><a class="l" href="#419">419 </a>
</span><span id="420" class="l"><a class="l" href="#420">420 </a>        }
</span><span id="421" class="l"><a class="l" href="#421">421 </a>
</span><span id="422" class="l"><a class="l" href="#422">422 </a>        <span class="php-comment">// Close file and return</span>
</span><span id="423" class="l"><a class="l" href="#423">423 </a>        <span class="php-keyword2">fclose</span>(<span class="php-var">$f</span>);
</span><span id="424" class="l"><a class="l" href="#424">424 </a>
</span><span id="425" class="l"><a class="l" href="#425">425 </a>        <span class="php-keyword1">return</span> <span class="php-keyword2">explode</span>(PHP_EOL, <span class="php-keyword2">trim</span>(<span class="php-var">$output</span>));
</span><span id="426" class="l"><a class="l" href="#426">426 </a>
</span><span id="427" class="l"><a class="l" href="#427">427 </a>    }
</span><span id="428" class="l"><a class="l" href="#428">428 </a>
</span><span id="429" class="l"><a class="l" href="#429">429 </a>    <span class="php-comment">/**
</span></span><span id="430" class="l"><a class="l" href="#430">430 </a><span class="php-comment">     * Définit les permissions sur un fichier (chmod)
</span></span><span id="431" class="l"><a class="l" href="#431">431 </a><span class="php-comment">     *
</span></span><span id="432" class="l"><a class="l" href="#432">432 </a><span class="php-comment">     * Dans le doute, mieux vaut s'abstenir de faire ceci sur des fichiers Windows
</span></span><span id="433" class="l"><a class="l" href="#433">433 </a><span class="php-comment">     *
</span></span><span id="434" class="l"><a class="l" href="#434">434 </a><span class="php-comment">     * @param string  $fileName Nom du fichier
</span></span><span id="435" class="l"><a class="l" href="#435">435 </a><span class="php-comment">     * @param int     $chmod    Chmod à appliquer au fichier
</span></span><span id="436" class="l"><a class="l" href="#436">436 </a><span class="php-comment">     *
</span></span><span id="437" class="l"><a class="l" href="#437">437 </a><span class="php-comment">     * @return bool
</span></span><span id="438" class="l"><a class="l" href="#438">438 </a><span class="php-comment">     */</span>
</span><span id="439" class="l"><a class="l" href="#439">439 </a>    <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> <a id="_setChmod" href="#_setChmod">setChmod</a>(<span class="php-var">$fileName</span>, <span class="php-var">$chmod</span>){
</span><span id="440" class="l"><a class="l" href="#440">440 </a>        <span class="php-var">$ret</span> = <span class="php-keyword2">exec</span>(<span class="php-quote">'sudo chmod '</span>.<span class="php-var">$chmod</span>.<span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;mountName . DIRECTORY_SEPARATOR . <span class="php-var">$fileName</span>.<span class="php-quote">' 2&gt;&amp;1'</span>, <span class="php-var">$output</span>);
</span><span id="441" class="l"><a class="l" href="#441">441 </a>        <span class="php-keyword1">if</span> (<span class="php-keyword1">empty</span>(<span class="php-var">$ret</span>)){
</span><span id="442" class="l"><a class="l" href="#442">442 </a>            <span class="php-keyword1">return</span> <span class="php-keyword1">true</span>;
</span><span id="443" class="l"><a class="l" href="#443">443 </a>        }
</span><span id="444" class="l"><a class="l" href="#444">444 </a>        <span class="php-keyword1">new</span> Alert(<span class="php-quote">'error'</span>, <span class="php-quote">'Impossible de changer les droits sur le fichier &lt;code&gt;'</span>.<span class="php-var">$fileName</span>.<span class="php-quote">'&lt;/code&gt;'</span>);
</span><span id="445" class="l"><a class="l" href="#445">445 </a>        <span class="php-keyword1">return</span> <span class="php-keyword1">false</span>;
</span><span id="446" class="l"><a class="l" href="#446">446 </a>    }
</span><span id="447" class="l"><a class="l" href="#447">447 </a>
</span><span id="448" class="l"><a class="l" href="#448">448 </a>    <span class="php-comment">/**
</span></span><span id="449" class="l"><a class="l" href="#449">449 </a><span class="php-comment">     * retourne le nom du montage réseau
</span></span><span id="450" class="l"><a class="l" href="#450">450 </a><span class="php-comment">     *
</span></span><span id="451" class="l"><a class="l" href="#451">451 </a><span class="php-comment">     * @return string
</span></span><span id="452" class="l"><a class="l" href="#452">452 </a><span class="php-comment">     */</span>
</span><span id="453" class="l"><a class="l" href="#453">453 </a>    <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> <a id="_getMountName" href="#_getMountName">getMountName</a>() {
</span><span id="454" class="l"><a class="l" href="#454">454 </a>        <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;mountName;
</span><span id="455" class="l"><a class="l" href="#455">455 </a>    }
</span><span id="456" class="l"><a class="l" href="#456">456 </a></span>} </code></pre>
	</div>

	<div id="footer">
		 API documentation generated by <a href="http://apigen.org">ApiGen 2.8.0</a>
	</div>
</div>
</body>
</html>
